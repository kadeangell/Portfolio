const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ghostty-web-DzYsCKtA.js","assets/main-BL0nTH9_.js","assets/main-DXJwUBmo.css"])))=>i.map(i=>d[i]);
import{d as I,e as Ve,r as h,u as it,a as rt,b as ot,w as ct,_ as He,j as m,c as le}from"./main-BL0nTH9_.js";function lt(){if(typeof window>"u"||!window.GestureEvent)return 50;try{const t=navigator.userAgent?.match(/version\/([\d\.]+) safari/i);return parseFloat(t[1])>=17?120:320}catch{return 320}}function ut(t){return{method:"throttle",timeMs:t}}const ne=ut(lt());function at(t){return t===null||Array.isArray(t)&&t.length===0}function ht(t,e,s){if(typeof t=="string")s.set(e,t);else{s.delete(e);for(const i of t)s.append(e,i);s.has(e)||s.set(e,"")}return s}function Fe(){const t=new Map;return{on(e,s){const i=t.get(e)||[];return i.push(s),t.set(e,i),()=>this.off(e,s)},off(e,s){const i=t.get(e);i&&t.set(e,i.filter(n=>n!==s))},emit(e,s){t.get(e)?.forEach(i=>i(s))}}}function xe(t,e,s){function i(){t(),s.removeEventListener("abort",r)}const n=setTimeout(i,e);function r(){clearTimeout(n),s.removeEventListener("abort",r)}s.addEventListener("abort",r)}function be(){const t=Promise;if(Promise.hasOwnProperty("withResolvers"))return Promise.withResolvers();let e=()=>{},s=()=>{};return{promise:new t((i,n)=>{e=i,s=n}),resolve:e,reject:s}}function dt(t,e){let s=e;for(let i=t.length-1;i>=0;i--){const n=t[i];if(!n)continue;const r=s;s=()=>n(r)}s()}function Ce(){return new URLSearchParams(location.search)}var ze=class{updateMap=new Map;options={history:"replace",scroll:!1,shallow:!0};timeMs=ne.timeMs;transitions=new Set;resolvers=null;controller=null;lastFlushedAt=0;resetQueueOnNextPush=!1;push({key:t,query:e,options:s},i=ne.timeMs){this.resetQueueOnNextPush&&(this.reset(),this.resetQueueOnNextPush=!1),I("[nuqs gtq] Enqueueing %s=%s %O",t,e,s),this.updateMap.set(t,e),s.history==="push"&&(this.options.history="push"),s.scroll&&(this.options.scroll=!0),s.shallow===!1&&(this.options.shallow=!1),s.startTransition&&this.transitions.add(s.startTransition),(!Number.isFinite(this.timeMs)||i>this.timeMs)&&(this.timeMs=i)}getQueuedQuery(t){return this.updateMap.get(t)}getPendingPromise({getSearchParamsSnapshot:t=Ce}){return this.resolvers?.promise??Promise.resolve(t())}flush({getSearchParamsSnapshot:t=Ce,rateLimitFactor:e=1,...s},i){if(this.controller??=new AbortController,!Number.isFinite(this.timeMs))return I("[nuqs gtq] Skipping flush due to throttleMs=Infinity"),Promise.resolve(t());if(this.resolvers)return this.resolvers.promise;this.resolvers=be();const n=()=>{this.lastFlushedAt=performance.now();const[o,c]=this.applyPendingUpdates({...s,autoResetQueueOnUpdate:s.autoResetQueueOnUpdate??!0,getSearchParamsSnapshot:t},i);c===null?(this.resolvers.resolve(o),this.resetQueueOnNextPush=!0):this.resolvers.reject(o),this.resolvers=null};return xe(()=>{const o=performance.now()-this.lastFlushedAt,c=this.timeMs,l=e*Math.max(0,c-o);I("[nuqs gtq] Scheduling flush in %f ms. Throttled at %f ms (x%f)",l,c,e),l===0?n():xe(n,l,this.controller.signal)},0,this.controller.signal),this.resolvers.promise}abort(){return this.controller?.abort(),this.controller=new AbortController,this.resolvers?.resolve(new URLSearchParams),this.resolvers=null,this.reset()}reset(){const t=Array.from(this.updateMap.keys());return I("[nuqs gtq] Resetting queue %s",JSON.stringify(Object.fromEntries(this.updateMap))),this.updateMap.clear(),this.transitions.clear(),this.options={history:"replace",scroll:!1,shallow:!0},this.timeMs=ne.timeMs,t}applyPendingUpdates(t,e){const{updateUrl:s,getSearchParamsSnapshot:i}=t;let n=i();if(I("[nuqs gtq] Applying %d pending update(s) on top of %s",this.updateMap.size,n.toString()),this.updateMap.size===0)return[n,null];const r=Array.from(this.updateMap.entries()),o={...this.options},c=Array.from(this.transitions);t.autoResetQueueOnUpdate&&this.reset(),I("[nuqs gtq] Flushing queue %O with options %O",r,o);for(const[l,u]of r)u===null?n.delete(l):n=ht(u,l,n);e&&(n=e(n));try{return dt(c,()=>{s(n,o)}),[n,null]}catch(l){return console.error(Ve(429),r.map(([u])=>u).join(),l),[n,l]}}};const oe=new ze;function ft(t,e,s){const i=h.useCallback(()=>{const r=Object.fromEntries(t.map(o=>[o,s(o)]));return[JSON.stringify(r),r]},[t.join(","),s]),n=h.useRef(null);return n.current===null&&(n.current=i()),h.useSyncExternalStore(h.useCallback(r=>{const o=t.map(c=>e(c,r));return()=>o.forEach(c=>c())},[t.join(","),e]),()=>{const[r,o]=i();return n.current[0]===r?n.current[1]:(n.current=[r,o],o)},()=>n.current[1])}var pt=class{callback;resolvers=be();controller=new AbortController;queuedValue=void 0;constructor(t){this.callback=t}abort(){this.controller.abort(),this.queuedValue=void 0}push(t,e){return this.queuedValue=t,this.controller.abort(),this.controller=new AbortController,xe(()=>{const s=this.resolvers;try{I("[nuqs dq] Flushing debounce queue",t);const i=this.callback(t);I("[nuqs dq] Reset debounce queue %O",this.queuedValue),this.queuedValue=void 0,this.resolvers=be(),i.then(n=>s.resolve(n)).catch(n=>s.reject(n))}catch(i){this.queuedValue=void 0,s.reject(i)}},e,this.controller.signal),this.resolvers.promise}},mt=class{throttleQueue;queues=new Map;queuedQuerySync=Fe();constructor(t=new ze){this.throttleQueue=t}useQueuedQueries(t){return ft(t,(e,s)=>this.queuedQuerySync.on(e,s),e=>this.getQueuedQuery(e))}push(t,e,s,i){if(!Number.isFinite(e)){const o=s.getSearchParamsSnapshot??Ce;return Promise.resolve(o())}const n=t.key;if(!this.queues.has(n)){I("[nuqs dqc] Creating debounce queue for `%s`",n);const o=new pt(c=>(this.throttleQueue.push(c),this.throttleQueue.flush(s,i).finally(()=>{this.queues.get(c.key)?.queuedValue===void 0&&(I("[nuqs dqc] Cleaning up empty queue for `%s`",c.key),this.queues.delete(c.key)),this.queuedQuerySync.emit(c.key)})));this.queues.set(n,o)}I("[nuqs dqc] Enqueueing debounce update %O",t);const r=this.queues.get(n).push(t,e);return this.queuedQuerySync.emit(n),r}abort(t){const e=this.queues.get(t);return e?(I("[nuqs dqc] Aborting debounce queue %s=%s",t,e.queuedValue?.query),this.queues.delete(t),e.abort(),this.queuedQuerySync.emit(t),s=>(s.then(e.resolvers.resolve,e.resolvers.reject),s)):s=>s}abortAll(){for(const[t,e]of this.queues.entries())I("[nuqs dqc] Aborting debounce queue %s=%s",t,e.queuedValue?.query),e.abort(),e.resolvers.resolve(new URLSearchParams),this.queuedQuerySync.emit(t);this.queues.clear()}getQueuedQuery(t){const e=this.queues.get(t)?.queuedValue?.query;return e!==void 0?e:this.throttleQueue.getQueuedQuery(t)}};const de=new mt(oe);function wt(t,e){return t===e?!0:t===null||e===null||typeof t=="string"||typeof e=="string"||t.length!==e.length?!1:t.every((s,i)=>s===e[i])}function Ue(t,e,s){try{return t(e)}catch(i){return ct("[nuqs] Error while parsing value `%s`: %O"+(s?" (for key `%s`)":""),e,i,s),null}}function H(t){function e(s){if(typeof s>"u")return null;let i="";if(Array.isArray(s)){if(s[0]===void 0)return null;i=s[0]}return typeof s=="string"&&(i=s),Ue(t.parse,i)}return{type:"single",eq:(s,i)=>s===i,...t,parseServerSide:e,withDefault(s){return{...this,defaultValue:s,parseServerSide(i){return e(i)??s}}},withOptions(s){return{...this,...s}}}}const gt=H({parse:t=>t,serialize:String});H({parse:t=>{const e=parseInt(t);return e==e?e:null},serialize:t=>""+Math.round(t)});H({parse:t=>{const e=parseInt(t);return e==e?e-1:null},serialize:t=>""+Math.round(t+1)});H({parse:t=>{const e=parseInt(t,16);return e==e?e:null},serialize:t=>{const e=Math.round(t).toString(16);return(e.length&1?"0":"")+e}});H({parse:t=>{const e=parseFloat(t);return e==e?e:null},serialize:String});H({parse:t=>t.toLowerCase()==="true",serialize:String});function Se(t,e){return t.valueOf()===e.valueOf()}H({parse:t=>{const e=parseInt(t);return e==e?new Date(e):null},serialize:t=>""+t.valueOf(),eq:Se});H({parse:t=>{const e=new Date(t);return e.valueOf()==e.valueOf()?e:null},serialize:t=>t.toISOString(),eq:Se});H({parse:t=>{const e=new Date(t.slice(0,10));return e.valueOf()==e.valueOf()?e:null},serialize:t=>t.toISOString().slice(0,10),eq:Se});const fe=Fe(),yt={};function vt(t,e={}){const s=h.useId(),i=it(),n=rt(),{history:r="replace",scroll:o=i?.scroll??!1,shallow:c=i?.shallow??!0,throttleMs:l=ne.timeMs,limitUrlUpdates:u=i?.limitUrlUpdates,clearOnDefault:a=i?.clearOnDefault??!0,startTransition:d,urlKeys:p=yt}=e,f=Object.keys(t).join(","),y=h.useMemo(()=>Object.fromEntries(Object.keys(t).map(v=>[v,p[v]??v])),[f,JSON.stringify(p)]),w=ot(Object.values(y)),b=w.searchParams,k=h.useRef({}),T=h.useMemo(()=>Object.fromEntries(Object.keys(t).map(v=>[v,t[v].defaultValue??null])),[Object.values(t).map(({defaultValue:v})=>v).join(",")]),$=de.useQueuedQueries(Object.values(y)),[A,M]=h.useState(()=>pe(t,p,b??new URLSearchParams,$).state),S=h.useRef(A);if(I("[nuq+ %s `%s`] render - state: %O, iSP: %s",s,f,A,b),Object.keys(k.current).join("&")!==Object.values(y).join("&")){const{state:v,hasChanged:C}=pe(t,p,b,$,k.current,S.current);C&&(I("[nuq+ %s `%s`] State changed: %O",s,f,{state:v,initialSearchParams:b,queuedQueries:$,queryRef:k.current,stateRef:S.current}),S.current=v,M(v)),k.current=Object.fromEntries(Object.entries(y).map(([P,O])=>[O,t[P]?.type==="multi"?b?.getAll(O):b?.get(O)??null]))}h.useEffect(()=>{const{state:v,hasChanged:C}=pe(t,p,b,$,k.current,S.current);C&&(I("[nuq+ %s `%s`] State changed: %O",s,f,{state:v,initialSearchParams:b,queuedQueries:$,queryRef:k.current,stateRef:S.current}),S.current=v,M(v))},[Object.values(y).map(v=>`${v}=${b?.getAll(v)}`).join("&"),JSON.stringify($)]),h.useEffect(()=>{const v=Object.keys(t).reduce((C,P)=>(C[P]=({state:O,query:z})=>{M(U=>{const{defaultValue:K}=t[P],F=y[P],J=O??K??null,x=U[P]??K??null;return Object.is(x,J)?(I("[nuq+ %s `%s`] Cross-hook key sync %s: %O (default: %O). no change, skipping, resolved: %O",s,f,F,O,K,S.current),U):(S.current={...S.current,[P]:J},k.current[F]=z,I("[nuq+ %s `%s`] Cross-hook key sync %s: %O (default: %O). updateInternalState, resolved: %O",s,f,F,O,K,S.current),S.current)})},C),{});for(const C of Object.keys(t)){const P=y[C];I("[nuq+ %s `%s`] Subscribing to sync for `%s`",s,P,f),fe.on(P,v[C])}return()=>{for(const C of Object.keys(t)){const P=y[C];I("[nuq+ %s `%s`] Unsubscribing to sync for `%s`",s,P,f),fe.off(P,v[C])}}},[f,y]);const Y=h.useCallback((v,C={})=>{const P=Object.fromEntries(Object.keys(t).map(x=>[x,null])),O=typeof v=="function"?v(je(S.current,T))??P:v??P;I("[nuq+ %s `%s`] setState: %O",s,f,O);let z,U=0,K=!1;const F=[];for(let[x,_]of Object.entries(O)){const g=t[x],E=y[x];if(!g||_===void 0)continue;(C.clearOnDefault??g.clearOnDefault??a)&&_!==null&&g.defaultValue!==void 0&&(g.eq??((q,D)=>q===D))(_,g.defaultValue)&&(_=null);const R=_===null?null:(g.serialize??String)(_);fe.emit(E,{state:_,query:R});const j={key:E,query:R,options:{history:C.history??g.history??r,shallow:C.shallow??g.shallow??c,scroll:C.scroll??g.scroll??o,startTransition:C.startTransition??g.startTransition??d}};if(C?.limitUrlUpdates?.method==="debounce"||u?.method==="debounce"||g.limitUrlUpdates?.method==="debounce"){j.options.shallow===!0&&console.warn(Ve(422));const q=C?.limitUrlUpdates?.timeMs??u?.timeMs??g.limitUrlUpdates?.timeMs??ne.timeMs,D=de.push(j,q,w,n);U<q&&(z=D,U=q)}else{const q=C?.limitUrlUpdates?.timeMs??g?.limitUrlUpdates?.timeMs??u?.timeMs??C.throttleMs??g.throttleMs??l;F.push(de.abort(E)),oe.push(j,q),K=!0}}const J=F.reduce((x,_)=>_(x),K?oe.flush(w,n):oe.getPendingPromise(w));return z??J},[f,r,c,o,l,u?.method,u?.timeMs,d,y,w.updateUrl,w.getSearchParamsSnapshot,w.rateLimitFactor,n,T]);return[h.useMemo(()=>je(A,T),[A,T]),Y]}function pe(t,e,s,i,n,r){let o=!1;const c=Object.entries(t).reduce((l,[u,a])=>{const d=e?.[u]??u,p=i[d],f=a.type==="multi"?[]:null,y=p===void 0?(a.type==="multi"?s?.getAll(d):s?.get(d))??f:p;return n&&r&&wt(n[d]??f,y)?(l[u]=r[u]??null,l):(o=!0,l[u]=(at(y)?null:Ue(a.parse,y,d))??null,n&&(n[d]=y),l)},{});if(!o){const l=Object.keys(t),u=Object.keys(r??{});o=l.length!==u.length||l.some(a=>!u.includes(a))}return{state:c,hasChanged:o}}function je(t,e){return Object.fromEntries(Object.keys(t).map(s=>[s,t[s]??e[s]??null]))}function xt(t,e={}){const{parse:s,type:i,serialize:n,eq:r,defaultValue:o,...c}=e,[{[t]:l},u]=vt({[t]:{parse:s??(a=>a),type:i,serialize:n,eq:r,defaultValue:o}},c);return[l,h.useCallback((a,d={})=>u(p=>({[t]:typeof a=="function"?a(p[t]):a}),d),[t,u])]}function Z(t,e){return{kind:"file",name:t,content:e}}function me(t,e){const s={};for(const i of e)s[i.name]=i;return{kind:"dir",name:t,children:s}}const ce=me("/",[Z("about.txt",`Hello! I'm Kade Angell.
Welcome to my portfolio.
`),Z("resume.txt",`Resume placeholder — content coming soon.
`),me("projects",[Z("portfolio.txt",`portfolio — this terminal-based portfolio site.
Built with React, TypeScript, and ghostty-web.
`),Z("zaymo.txt",`zaymo — placeholder project description.
`)]),me("links",[Z("github.txt",`https://github.com/kadeangell
`),Z("linkedin.txt",`https://linkedin.com/in/kadeangell
`)])]),Pe="vfs:";function V(t,e){if(e==="~"||e==="")return"/";const s=e.startsWith("/")?e.split("/"):[...t.split("/"),...e.split("/")],i=[];for(const n of s)n===""||n==="."||(n===".."?i.pop():i.push(n));return"/"+i.join("/")}function G(t){if(t==="/")return ce;const e=t.split("/").filter(Boolean);let s=ce;for(const i of e){if(s.kind!=="dir")return;const n=s.children[i];if(!n)return;s=n}return s}function Qe(t){const e=G(t);return!e||e.kind!=="dir"?null:Object.keys(e.children)}function Be(t){const e=G(t);return!e||e.kind!=="file"?null:e.content}function Ge(t){const e=G(t);return e!==void 0&&e.kind==="dir"}function Me(t,e){const s=t.split("/").filter(Boolean),i=s.pop();if(!i)return!1;let n=ce;for(const o of s){if(n.kind!=="dir")return!1;let c=n.children[o];if(!c){const l={kind:"dir",name:o,children:{}};n.children[o]=l,c=l}if(c.kind!=="dir")return!1;n=c}if(n.kind!=="dir")return!1;const r=n.children[i];if(r&&r.kind==="dir")return!1;n.children[i]={kind:"file",name:i,content:e};try{localStorage.setItem(Pe+t,e)}catch{}return!0}function bt(t,e){const s=t.split("/").filter(Boolean),i=s.pop();if(!i)return;let n=ce;for(const r of s){if(n.kind!=="dir")return;let o=n.children[r];if(!o){const c={kind:"dir",name:r,children:{}};n.children[r]=c,o=c}if(o.kind!=="dir")return;n=o}n.kind==="dir"&&(n.children[i]={kind:"file",name:i,content:e})}function Ct(){try{for(let t=0;t<localStorage.length;t++){const e=localStorage.key(t);if(!e?.startsWith(Pe))continue;const s=e.slice(Pe.length),i=localStorage.getItem(e);i!==null&&bt(s,i)}}catch{}}Ct();const B=new Map;B.set("help",(t,e)=>{e.write(`\r
Available commands:\r
`),e.write(`  help     Show this message\r
`),e.write(`  clear    Clear the screen\r
`),e.write(`  echo     Print arguments\r
`),e.write(`  whoami   Display current user\r
`),e.write(`  date     Display current date\r
`),e.write(`  pwd      Print working directory\r
`),e.write(`  ls       List directory contents\r
`),e.write(`  cd       Change directory\r
`),e.write(`  cat      Print file contents\r
`),e.write(`  history  Show command history\r
`),e.write(`  vim      Open file in Vim editor\r
`),e.write(`  github   Open GitHub profile\r
`),e.write(`  linkedin Open LinkedIn profile\r
`),e.write(`  legacy   Open legacy portfolio\r
`),e.write(`  rainbow  Test color output\r
`),e.write(`  tmux     Terminal multiplexer\r
`)});B.set("history",(t,e,s)=>{const i=s.getCommandHistory();if(i.length===0){e.write(`\r
(no history)`);return}for(let n=0;n<i.length;n++)e.write(`\r
  ${String(n+1).padStart(4)}  ${i[n]}`)});B.set("clear",(t,e,s)=>{s.clearHistory(),e.write("\x1B[2J\x1B[H")});B.set("echo",(t,e)=>{e.write(`\r
`+t.join(" "))});B.set("whoami",(t,e)=>{e.write(`\r
guest`)});B.set("date",(t,e)=>{e.write(`\r
`+new Date().toString())});B.set("pwd",(t,e,s)=>{e.write(`\r
`+s.cwd)});B.set("ls",(t,e,s)=>{const i=t[0]?V(s.cwd,t[0]):s.cwd,n=Qe(i);if(!n){e.write(`\r
ls: ${t[0]||i}: No such directory`);return}const r=G(i);if(!r||r.kind!=="dir")return;const o=[];for(const c of n)r.children[c].kind==="dir"?o.push(`\x1B[1;34m${c}/\x1B[0m`):o.push(c);e.write(`\r
`+o.join("  "))});B.set("cd",(t,e,s)=>{const i=t[0];if(!i||i==="~"){s.setCwd("/");return}const n=V(s.cwd,i);if(!Ge(n)){e.write(`\r
cd: ${i}: No such directory`);return}s.setCwd(n)});B.set("cat",(t,e,s)=>{if(!t[0]){e.write(`\r
cat: missing file operand`);return}const i=V(s.cwd,t[0]),n=G(i);if(!n){e.write(`\r
cat: ${t[0]}: No such file or directory`);return}if(n.kind==="dir"){e.write(`\r
cat: ${t[0]}: Is a directory`);return}const r=Be(i);r!==null&&e.write(`\r
`+r.replace(/\n/g,`\r
`))});B.set("rainbow",(t,e)=>{const i="\x1B[0m",n=[{code:"31",name:"red"},{code:"33",name:"yellow"},{code:"32",name:"green"},{code:"36",name:"cyan"},{code:"34",name:"blue"},{code:"35",name:"magenta"}];e.write(`\r
`);for(const r of n)e.write(`\x1B[${r.code}m${"█".repeat(8)}${i}`);e.write(`\r
`);for(const r of n)e.write(`\x1B[${r.code}m${r.name.padEnd(8)}${i}`);e.write(`\r
`);for(const r of n)e.write(`\x1B[${r.code};1m${"█".repeat(8)}${i}`);e.write(`\r
`),e.write(`\r
  256-color gradient:\r
  `);for(let r=196;r<=201;r++)e.write(`\x1B[38;5;${r}m██${i}`);for(let r=207;r>=202;r--)e.write(`\x1B[38;5;${r}m██${i}`);e.write(`\r
  `),e.write(`\r
  RGB true color:\r
  `);for(let r=0;r<48;r++){const o=r/48*360,[c,l,u]=Pt(o,100,50);e.write(`\x1B[38;2;${c};${l};${u}m█${i}`)}e.write(`\r
`)});function Pt(t,e,s){e/=100,s/=100;const i=o=>(o+t/30)%12,n=e*Math.min(s,1-s),r=o=>s-n*Math.max(-1,Math.min(i(o)-3,Math.min(9-i(o),1)));return[Math.round(r(0)*255),Math.round(r(8)*255),Math.round(r(4)*255)]}B.set("github",(t,e)=>{e.write(`\r
Opening GitHub...`),window.open("https://github.com/kadeangell","_blank")});B.set("linkedin",(t,e)=>{e.write(`\r
Opening LinkedIn...`),window.open("https://www.linkedin.com/in/kade-angell","_blank")});B.set("legacy",(t,e)=>{e.write(`\r
Opening legacy portfolio...`),window.open("/legacy/","_blank")});const $e=(t,e,s)=>{const i=t[0];if(i){const n=V(s.cwd,i);if(G(n)?.kind==="dir"){e.write(`\r
vim: ${i}: Is a directory`);return}}return s.runProcess("vim",t),"suppress-prompt"};B.set("vim",$e);B.set("vi",$e);B.set("nvim",$e);B.set("tmux",(t,e,s)=>{if(s.startTmux)return s.startTmux(),"suppress-prompt";e.write(`\r
tmux: not available`)});function _t(t){return B.get(t)}function kt(){return[...B.keys()]}const Ye="shell-history",It=500;function St(){try{const t=localStorage.getItem(Ye);if(t)return JSON.parse(t)}catch{}return[]}function Bt(t){try{localStorage.setItem(Ye,JSON.stringify(t.slice(-It)))}catch{}}class Je{inputBuffer="";cursorPos=0;writer;inputListeners=new Set;keybinds=new Map;escapeBuffer="";inEscapeSequence=!1;getContext=()=>({cwd:"/",setCwd:()=>{},clearHistory:()=>{},runProcess:()=>{},getCommandHistory:()=>[]});onBeforePrompt=()=>{};onInputChange=()=>{};history=St();historyIndex=-1;savedInput="";mode={kind:"normal"};constructor(e){this.writer=e}setContextProvider(e){this.getContext=e}setBeforePromptCallback(e){this.onBeforePrompt=e}setInputChangeCallback(e){this.onInputChange=e}notifyInputChange(){const e=this.mode.kind==="search"?`(reverse-i-search)'${this.mode.query}': `:this.buildPrompt();this.onInputChange(this.inputBuffer,this.cursorPos,e)}buildPrompt(){const e=this.getContext();return`${e.cwd==="/"?"~":"~"+e.cwd} $ `}printPrompt(){this.writer.write(this.buildPrompt())}getHistory(){return this.history}onInput(e){return this.inputListeners.add(e),()=>this.inputListeners.delete(e)}registerKeybind(e,s){return this.keybinds.set(e,s),()=>this.keybinds.delete(e)}pushHistory(e){this.history.length>0&&this.history[this.history.length-1]===e||(this.history.push(e),Bt(this.history))}resetHistoryBrowsing(){this.historyIndex=-1,this.savedInput=""}replaceInputLine(e){this.cursorPos>0&&this.writer.write(`\x1B[${this.cursorPos}D`),this.writer.write("\x1B[K"),this.writer.write(e),this.inputBuffer=e,this.cursorPos=e.length}searchMatch(){if(this.mode.kind!=="search")return null;const{query:e,matchIndex:s}=this.mode;if(!e)return null;let i=0;for(let n=this.history.length-1;n>=0;n--)if(this.history[n].includes(e)){if(i===s)return this.history[n];i++}return null}redrawSearchPrompt(){if(this.mode.kind!=="search")return;const e=this.searchMatch()??"";this.writer.write("\r\x1B[K"),this.writer.write(`(reverse-i-search)'${this.mode.query}': ${e}`),this.inputBuffer=e,this.cursorPos=e.length}enterSearchMode(){this.savedInput=this.inputBuffer,this.mode={kind:"search",query:"",matchIndex:0},this.redrawSearchPrompt(),this.notifyInputChange()}exitSearchMode(e){const s=e?this.searchMatch():null;this.mode={kind:"normal"};const i=this.buildPrompt(),n=e&&s!==null?s:this.savedInput;this.inputBuffer=n,this.cursorPos=n.length,this.savedInput="",this.writer.write("\r\x1B[K"+i+n),this.notifyInputChange()}handleData(e){for(const s of this.inputListeners)s(e);for(let s=0;s<e.length;s++){const i=e[s],n=i.charCodeAt(0);if(this.inEscapeSequence){if(this.escapeBuffer+=i,this.escapeBuffer==="[")continue;if(this.escapeBuffer.startsWith("[")){if(this.mode.kind==="search"){this.exitSearchMode(!1),this.inEscapeSequence=!1,this.escapeBuffer="";continue}this.handleEscapeSequence(this.escapeBuffer),this.notifyInputChange()}this.inEscapeSequence=!1,this.escapeBuffer="";continue}if(n===27){if(this.mode.kind==="search"){this.exitSearchMode(!1);continue}this.inEscapeSequence=!0,this.escapeBuffer="";continue}if(this.mode.kind==="search"){if(n===18){this.mode={...this.mode,matchIndex:this.mode.matchIndex+1},this.redrawSearchPrompt(),this.notifyInputChange();continue}if(n===7){this.exitSearchMode(!1);continue}if(n===3){this.exitSearchMode(!1);continue}if(n===13){const r=this.searchMatch();if(this.exitSearchMode(!0),r){this.writer.write(`\r
`),this.pushHistory(r),this.inputBuffer="",this.cursorPos=0;let o=!1;o=this.executeCommand(r)==="suppress-prompt",this.onBeforePrompt(),o||this.printPrompt(),this.notifyInputChange()}continue}if(n===127||n===8){this.mode.query.length>0&&(this.mode={...this.mode,query:this.mode.query.slice(0,-1),matchIndex:0},this.redrawSearchPrompt(),this.notifyInputChange());continue}if(n>=32){this.mode={...this.mode,query:this.mode.query+i,matchIndex:0},this.redrawSearchPrompt(),this.notifyInputChange();continue}this.exitSearchMode(!0)}if(n===18){this.enterSearchMode();continue}if(n===3){if(this.checkKeybind("ctrl+c"))continue;this.resetHistoryBrowsing(),this.writer.write(`^C\r
`),this.inputBuffer="",this.cursorPos=0,this.onBeforePrompt(),this.printPrompt(),this.notifyInputChange();continue}if(n===4){if(this.checkKeybind("ctrl+d"))continue;continue}if(n===12){if(this.checkKeybind("ctrl+l"))continue;this.getContext().clearHistory(),this.writer.write("\x1B[2J\x1B[H"),this.printPrompt(),this.writer.write(this.inputBuffer);const r=this.inputBuffer.length-this.cursorPos;r>0&&this.writer.write(`\x1B[${r}D`),this.notifyInputChange();continue}if(n===1){if(this.checkKeybind("ctrl+a"))continue;this.cursorPos>0&&(this.writer.write(`\x1B[${this.cursorPos}D`),this.cursorPos=0),this.notifyInputChange();continue}if(n===5){if(this.checkKeybind("ctrl+e"))continue;if(this.cursorPos<this.inputBuffer.length){const r=this.inputBuffer.length-this.cursorPos;this.writer.write(`\x1B[${r}C`),this.cursorPos=this.inputBuffer.length}this.notifyInputChange();continue}if(n===23){if(this.checkKeybind("ctrl+w"))continue;if(this.cursorPos>0){let r=this.cursorPos;for(;r>0&&this.inputBuffer[r-1]===" ";)r--;for(;r>0&&this.inputBuffer[r-1]!==" ";)r--;const o=this.cursorPos-r,c=this.inputBuffer.slice(0,r),l=this.inputBuffer.slice(this.cursorPos);this.inputBuffer=c+l,this.writer.write(`\x1B[${o}D`),this.writer.write(l+" ".repeat(o)),this.writer.write(`\x1B[${l.length+o}D`),this.cursorPos=r}this.notifyInputChange();continue}if(n===11){if(this.checkKeybind("ctrl+k"))continue;this.cursorPos<this.inputBuffer.length&&(this.inputBuffer=this.inputBuffer.slice(0,this.cursorPos),this.writer.write("\x1B[K")),this.notifyInputChange();continue}if(n===21){if(this.checkKeybind("ctrl+u"))continue;if(this.cursorPos>0){this.writer.write(`\x1B[${this.cursorPos}D`),this.writer.write("\x1B[K");const r=this.inputBuffer.slice(this.cursorPos);this.inputBuffer=r,this.cursorPos=0,this.writer.write(r),r.length>0&&this.writer.write(`\x1B[${r.length}D`)}this.notifyInputChange();continue}if(n===127||n===8){if(this.cursorPos>0){const r=this.inputBuffer.slice(0,this.cursorPos-1),o=this.inputBuffer.slice(this.cursorPos);this.inputBuffer=r+o,this.cursorPos--,this.writer.write("\b"),this.writer.write(o+" "),this.writer.write(`\x1B[${o.length+1}D`)}this.notifyInputChange();continue}if(n===13){this.writer.write(`\r
`);const r=this.inputBuffer.trim();this.inputBuffer="",this.cursorPos=0,this.resetHistoryBrowsing();let o=!1;r&&(this.pushHistory(r),o=this.executeCommand(r)==="suppress-prompt"),this.onBeforePrompt(),o||this.printPrompt(),this.notifyInputChange();continue}if(n===9){if(this.checkKeybind("tab"))continue;this.handleTab();continue}if(n>=32){this.resetHistoryBrowsing();const r=this.inputBuffer.slice(0,this.cursorPos),o=this.inputBuffer.slice(this.cursorPos);this.inputBuffer=r+i+o,this.cursorPos++,this.writer.write(i+o),o.length>0&&this.writer.write(`\x1B[${o.length}D`),this.notifyInputChange()}}}handleTab(){const s=this.inputBuffer.slice(0,this.cursorPos).split(/\s+/);if(s.length<=1){const n=s[0]||"",r=kt().filter(o=>o.startsWith(n));this.applyCompletion(n,r,!0)}else{const n=s[s.length-1]||"",r=this.getContext(),o=n.lastIndexOf("/");let c,l;o===-1?(c=r.cwd,l=n):(c=V(r.cwd,n.slice(0,o+1)),l=n.slice(o+1));const u=Qe(c);if(!u)return;const a=u.filter(f=>f.startsWith(l)),d=o===-1?"":n.slice(0,o+1),p=a.map(f=>{const y=G(V(r.cwd,d+f));return d+f+(y?.kind==="dir"?"/":"")});this.applyCompletion(n,p,!1)}}applyCompletion(e,s,i){if(s.length===0)return;let n;if(s.length===1)n=s[0]+(i?" ":"");else{n=s[0];for(let l=1;l<s.length;l++){let u=0;for(;u<n.length&&u<s[l].length&&n[u]===s[l][u];)u++;n=n.slice(0,u)}if(n===e){this.writer.write(`\r
`+s.join("  ")+`\r
`),this.onBeforePrompt(),this.printPrompt(),this.writer.write(this.inputBuffer);const l=this.inputBuffer.slice(this.cursorPos);l.length>0&&this.writer.write(`\x1B[${l.length}D`),this.notifyInputChange();return}}const r=n.slice(e.length);if(!r)return;const o=this.inputBuffer.slice(0,this.cursorPos),c=this.inputBuffer.slice(this.cursorPos);this.inputBuffer=o+r+c,this.cursorPos+=r.length,this.writer.write(r+c),c.length>0&&this.writer.write(`\x1B[${c.length}D`),this.notifyInputChange()}handleEscapeSequence(e){switch(e){case"[A":{if(this.history.length===0)break;if(this.historyIndex===-1)this.savedInput=this.inputBuffer,this.historyIndex=this.history.length-1;else if(this.historyIndex>0)this.historyIndex--;else break;this.replaceInputLine(this.history[this.historyIndex]);break}case"[B":{if(this.historyIndex===-1)break;this.historyIndex<this.history.length-1?(this.historyIndex++,this.replaceInputLine(this.history[this.historyIndex])):(this.historyIndex=-1,this.replaceInputLine(this.savedInput),this.savedInput="");break}case"[C":this.cursorPos<this.inputBuffer.length&&(this.cursorPos++,this.writer.write("\x1B[C"));break;case"[D":this.cursorPos>0&&(this.cursorPos--,this.writer.write("\x1B[D"));break;case"[H":this.cursorPos>0&&(this.writer.write(`\x1B[${this.cursorPos}D`),this.cursorPos=0);break;case"[F":if(this.cursorPos<this.inputBuffer.length){const s=this.inputBuffer.length-this.cursorPos;this.writer.write(`\x1B[${s}C`),this.cursorPos=this.inputBuffer.length}break;case"[3~":if(this.cursorPos<this.inputBuffer.length){const s=this.inputBuffer.slice(0,this.cursorPos),i=this.inputBuffer.slice(this.cursorPos+1);this.inputBuffer=s+i,this.writer.write(i+" "),this.writer.write(`\x1B[${i.length+1}D`)}break}}checkKeybind(e){const s=this.keybinds.get(e);return s?(s(),!0):!1}executeCommand(e){const s=e.split(/\s+/),i=s[0],n=s.slice(1),r=_t(i);if(r){if(r(n,this.writer,this.getContext())==="suppress-prompt")return"suppress-prompt";this.writer.write(`\r
`)}else this.writer.write(`${i}: command not found\r
`)}}function $t(t,e){const s={write(i){t.write(i)},onInput(i){return e.onInput(i)},registerKeybind(i,n){return e.registerKeybind(i,n)},clear(){t.write("\x1B[2J\x1B[H")},get cols(){return 80},get rows(){return 24}};return window.__terminal=s,()=>{delete window.__terminal}}const te="\x1B",ee=`${te}[0m`,Tt=`${te}[1m`,we=`${te}[2m`,qt=`${te}[32m`,Et=`${te}[36m`,ge=`${te}[37m`,jt=[" _  __          _      ","| |/ /__ _  __| | ___ ","| ' // _` |/ _` |/ _ \\","| . \\ (_| | (_| |  __/","|_|\\_\\__,_|\\__,_|\\___|"];function Mt(t){t.write(`\r
`);for(const e of jt)t.write(`  ${Et}${e}${ee}\r
`);t.write(`\r
`),t.write(`  ${Tt}${ge}kade angell${ee}${we} — software engineer${ee}\r
`),t.write(`\r
`),t.write(`  ${we}${ge}type ${ee}${qt}help${ee}${we}${ge} for available commands${ee}\r
`),t.write(`\r
`)}const Xe=new Map;function Te(t,e){Xe.set(t,e)}function Ze(t){return Xe.get(t)}class qe{config;vim=null;canvas=null;input=null;exitCallbacks=[];outputCallbacks=[];vimPathToVfsPath=new Map;constructor(e){this.config=e}async start(){const{VimWasm:e}=await He(async()=>{const{VimWasm:n}=await import("./vimwasm-DJXyD7PJ.js");return{VimWasm:n}},[]);this.canvas=document.createElement("canvas"),this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.display="block",this.canvas.style.background="#000000",this.config.container.appendChild(this.canvas),this.input=document.createElement("input"),this.input.style.position="absolute",this.input.style.left="-9999px",this.input.style.top="0",this.input.style.width="1px",this.input.style.height="1px",this.input.style.opacity="0",this.config.container.appendChild(this.input),this.vim=new e({canvas:this.canvas,input:this.input,workerScriptPath:"/vim-wasm/vim.js"}),this.vim.onVimInit=()=>{this.vim.cmdline("set guifont=monospace:h14"),this.vim.cmdline("highlight Normal guibg=#000000 guifg=#cccccc"),this.vim.cmdline("highlight NonText guibg=#000000 guifg=#555555"),this.vim.cmdline("highlight StatusLine guibg=#333333 guifg=#cccccc gui=NONE"),this.vim.cmdline("highlight StatusLineNC guibg=#1a1a1a guifg=#666666 gui=NONE"),this.vim.cmdline("highlight LineNr guibg=#000000 guifg=#555555"),this.vim.cmdline("highlight CursorLine guibg=#111111"),this.vim.cmdline("highlight Visual guibg=#264f78"),this.vim.cmdline("highlight Pmenu guibg=#1a1a1a guifg=#cccccc"),this.vim.cmdline("highlight PmenuSel guibg=#264f78 guifg=#cccccc"),this.vim.cmdline("highlight VertSplit guibg=#000000 guifg=#333333")},this.vim.onVimExit=n=>{this.cleanup();for(const r of this.exitCallbacks)r(0)},this.vim.onError=n=>{console.error("vim.wasm error:",n),this.cleanup();for(const r of this.exitCallbacks)r(1)},this.vim.onFileExport=(n,r)=>{const o=new TextDecoder().decode(new Uint8Array(r)),c=this.vimPathToVfsPath.get(n);if(c)Me(c,o);else{const l=n.split("/").pop();l&&Me(V(this.config.cwd,l),o)}};const s={},i=[];if(this.config.args.length>0){const n=this.config.args[0],r=this.config.env.__FILE_CONTENT__??"",o=this.config.env.__VFS_PATH__??"",c=`/tmp/${n}`;s[c]=r,i.push(c),o&&this.vimPathToVfsPath.set(c,o)}i.push("-c","autocmd BufWritePost * silent! export"),this.vim.start({files:Object.keys(s).length>0?s:void 0,cmdArgs:i}),this.input.focus()}cleanup(){this.canvas&&(this.canvas.remove(),this.canvas=null),this.input&&(this.input.remove(),this.input=null),this.vim=null}write(e){}resize(e,s){if(this.canvas&&this.vim){const i=this.config.container.getBoundingClientRect();i.width>0&&i.height>0&&this.vim.resize(i.width,i.height)}}terminate(){if(this.vim)try{this.vim.cmdline("qa!")}catch{this.cleanup();for(const e of this.exitCallbacks)e(1)}}onOutput(e){this.outputCallbacks.push(e)}onExit(e){this.exitCallbacks.push(e)}}function _e(t,e){const s=new Map;if(t.kind==="leaf")return s.set(t.paneId,e),s;const{direction:i,ratio:n,first:r,second:o}=t;let c,l;if(i==="vertical"){const u=e.width*n;c={x:e.x,y:e.y,width:u,height:e.height},l={x:e.x+u,y:e.y,width:e.width-u,height:e.height}}else{const u=e.height*n;c={x:e.x,y:e.y,width:e.width,height:u},l={x:e.x,y:e.y+u,width:e.width,height:e.height-u}}for(const[u,a]of _e(r,c))s.set(u,a);for(const[u,a]of _e(o,l))s.set(u,a);return s}function Ot(t,e,s){const i=t.get(e);if(!i)return null;const n=i.x+i.width/2,r=i.y+i.height/2;let o=null,c=1/0;for(const[l,u]of t){if(l===e)continue;const a=u.x+u.width/2,d=u.y+u.height/2;let p=!1;switch(s){case"left":p=a<n;break;case"right":p=a>n;break;case"up":p=d<r;break;case"down":p=d>r;break}if(!p)continue;const f=Math.abs(a-n)+Math.abs(d-r);f<c&&(c=f,o=l)}return o}function ke(t,e,s){return t.kind==="leaf"?t.paneId===e?s:t:{...t,first:ke(t.first,e,s),second:ke(t.second,e,s)}}function Ie(t,e){if(t.kind==="leaf")return t.paneId===e?null:t;const s=L(t.first).includes(e),i=L(t.second).includes(e);if(!s&&!i)return t;if(s&&t.first.kind==="leaf"&&t.first.paneId===e)return t.second;if(i&&t.second.kind==="leaf"&&t.second.paneId===e)return t.first;if(s){const n=Ie(t.first,e);return n===null?t.second:{...t,first:n}}else{const n=Ie(t.second,e);return n===null?t.first:{...t,second:n}}}function L(t){return t.kind==="leaf"?[t.paneId]:[...L(t.first),...L(t.second)]}const At="rgb(204,204,204)",Rt="rgb(0,0,0)",Oe={char:" ",fg:At,bg:Rt,bold:!1,italic:!1,underline:!1};function Dt(t){return`rgb(${t.fg_r},${t.fg_g},${t.fg_b})`}function Nt(t){return`rgb(${t.bg_r},${t.bg_g},${t.bg_b})`}function Ae(t,e,s){const i=t.getLine(e),n=[];if(i)for(let r=0;r<s;r++){const o=i[r];o?n.push({char:o.codepoint?String.fromCodePoint(o.codepoint):" ",fg:Dt(o),bg:Nt(o),bold:!!(o.flags&1),italic:!!(o.flags&4),underline:!!(o.flags&8)}):n.push(Oe)}else for(let r=0;r<s;r++)n.push(Oe);return n}function Wt(t){return t.some(e=>e.char!==" ")}class ye{id;shell;term;wasmTerm;hiddenContainer;ghosttyModule;cwd;paneSubscribers=new Set;_history=[];_inputLine="";_inputCursor=0;_promptText="";_mode="shell";_process=null;_processCleanup=null;processContainer=null;constructor(e){this.id=e.id,this.cwd=e.initialCwd,this.ghosttyModule=e.ghosttyModule,this.hiddenContainer=document.createElement("div"),this.hiddenContainer.style.position="absolute",this.hiddenContainer.style.left="-9999px",this.hiddenContainer.style.top="-9999px",this.hiddenContainer.style.width="1px",this.hiddenContainer.style.height="1px",this.hiddenContainer.style.overflow="hidden",document.body.appendChild(this.hiddenContainer);const s=this.ghosttyModule.Terminal;this.term=new s({fontSize:14}),this.term.open(this.hiddenContainer),this.wasmTerm=this.term.wasmTerm;const i={write:r=>{this.term.write(r)}};this.shell=new Je(i);const n=()=>{if(!this.wasmTerm)return;const r=this.term.cols||80,o=this.term.rows||24,l=this.wasmTerm.getCursor()?.y??0;let u=-1;for(let a=o-1;a>=0;a--){const d=Ae(this.wasmTerm,a,r);if(Wt(d)){u=a;break}}if(u>=0){const a=Math.max(u,l-1),d=[];for(let p=0;p<=a;p++)d.push(Ae(this.wasmTerm,p,r));this._history=[...this._history,...d]}this.term.write("\x1B[2J\x1B[H")};this.shell.setBeforePromptCallback(n),this.shell.setInputChangeCallback((r,o,c)=>{this._inputLine=r,this._inputCursor=o,this._promptText=c,this.notifyPaneSubscribers()}),this.shell.setContextProvider(()=>({cwd:this.cwd,setCwd:r=>{this.cwd=r},clearHistory:()=>{this._history=[],this.notifyPaneSubscribers()},runProcess:(r,o)=>{this.runProcess(r,o)},getCommandHistory:()=>this.shell.getHistory(),startTmux:void 0})),this.shell.printPrompt()}dispose(){this._process&&(this._process.terminate(),this._process=null),this.term?.dispose(),this.hiddenContainer.parentNode&&document.body.removeChild(this.hiddenContainer)}handleKeyData(e){this._mode!=="process"&&this.shell.handleData(e)}runProcess(e,s){const i=Ze(e);if(!i)return;const n=this.processContainer;if(!n)return;const r={};if(s.length>0){const l=V(this.cwd,s[0]);r.__VFS_PATH__=l;const u=Be(l);u!==null&&(r.__FILE_CONTENT__=u)}const o=i({wasmUrl:"",args:s,env:r,cwd:this.cwd,cols:this.term?.cols||80,rows:this.term?.rows||24,container:n}),c=()=>{n.replaceChildren(),this._mode="shell",this._process=null,this._processCleanup=null,this.notifyPaneSubscribers(),setTimeout(()=>{this.shell.printPrompt()},0)};o.onExit(()=>c()),this._mode="process",this._process=o,this._processCleanup=c,this.notifyPaneSubscribers(),o.start().catch(l=>{console.error("Failed to start process in pane:",l),c()})}setProcessContainer(e){this.processContainer=e}subscribe(e){return this.paneSubscribers.add(e),()=>this.paneSubscribers.delete(e)}notifyPaneSubscribers(){for(const e of this.paneSubscribers)e()}getHistory(){return this._history}getInputLine(){return this._inputLine}getInputCursor(){return this._inputCursor}getPromptText(){return this._promptText}getCwd(){return this.cwd}getMode(){return this._mode}getProcess(){return this._process}}let Kt=1,Lt=1;function ve(){return`pane-${Kt++}`}function Re(){return`win-${Lt++}`}class Vt{session;paneControllers=new Map;ghosttyModule;initialCwd;onChange;_prefixActive=!1;prefixTimeout=null;_overlay="none";_windowViewerIndex=0;_zoomedPaneId=null;constructor(e){this.ghosttyModule=e.ghosttyModule,this.initialCwd=e.initialCwd,this.onChange=e.onChange;const s=ve(),i=new ye({id:s,initialCwd:this.initialCwd,ghosttyModule:this.ghosttyModule});this.paneControllers.set(s,i);const n={id:Re(),name:"shell",layout:{kind:"leaf",paneId:s},activePaneId:s};this.session={windows:[n],activeWindowIndex:0}}getSnapshot(){return this.session}getActiveWindow(){return this.session.windows[this.session.activeWindowIndex]}getActivePane(){const e=this.getActiveWindow();return this.paneControllers.get(e.activePaneId)}getPaneController(e){return this.paneControllers.get(e)}computePaneRects(){const e=this.getActiveWindow();if(this._zoomedPaneId&&this.paneControllers.has(this._zoomedPaneId)){const s=new Map;return s.set(this._zoomedPaneId,{x:0,y:0,width:1,height:1}),s}return _e(e.layout,{x:0,y:0,width:1,height:1})}isPrefixActive(){return this._prefixActive}getOverlay(){return this._overlay}getWindowViewerIndex(){return this._windowViewerIndex}isZoomed(){return this._zoomedPaneId!==null}activatePrefix(){this._prefixActive=!0,this.prefixTimeout&&clearTimeout(this.prefixTimeout),this.prefixTimeout=setTimeout(()=>{this._prefixActive=!1,this.onChange()},2e3),this.onChange()}cancelPrefix(){this._prefixActive=!1,this.prefixTimeout&&(clearTimeout(this.prefixTimeout),this.prefixTimeout=null),this.onChange()}splitPane(e){const s=this.getActiveWindow(),i=s.activePaneId,n=this.paneControllers.get(i);if(!n)return;this._zoomedPaneId&&(this._zoomedPaneId=null);const r=ve(),o=new ye({id:r,initialCwd:n.getCwd(),ghosttyModule:this.ghosttyModule});this.paneControllers.set(r,o);const c={kind:"split",direction:e,ratio:.5,first:{kind:"leaf",paneId:i},second:{kind:"leaf",paneId:r}};s.layout=ke(s.layout,i,c),s.activePaneId=r,this.onChange()}navigatePane(e){const s=this.getActiveWindow(),i=this.computePaneRects(),n=Ot(i,s.activePaneId,e);n&&(s.activePaneId=n,this.onChange())}killPane(){const e=this.getActiveWindow(),s=e.activePaneId,i=L(e.layout);if(i.length<=1&&this.session.windows.length<=1)return;const n=this.paneControllers.get(s);if(n&&(n.dispose(),this.paneControllers.delete(s)),i.length<=1){this.session.windows.splice(this.session.activeWindowIndex,1),this.session.activeWindowIndex>=this.session.windows.length&&(this.session.activeWindowIndex=this.session.windows.length-1),this.onChange();return}const r=Ie(e.layout,s);if(r){e.layout=r;const o=L(r);e.activePaneId=o[0]}this._zoomedPaneId=null,this.onChange()}isLastPane(){const e=this.getActiveWindow();return L(e.layout).length<=1&&this.session.windows.length<=1}zoomPane(){const e=this.getActiveWindow();this._zoomedPaneId===e.activePaneId?this._zoomedPaneId=null:this._zoomedPaneId=e.activePaneId,this.onChange()}createWindow(){const e=ve(),s=new ye({id:e,initialCwd:this.initialCwd,ghosttyModule:this.ghosttyModule});this.paneControllers.set(e,s);const i={id:Re(),name:"shell",layout:{kind:"leaf",paneId:e},activePaneId:e};this.session.windows.push(i),this.session.activeWindowIndex=this.session.windows.length-1,this._zoomedPaneId=null,this.onChange()}nextWindow(){this.session.windows.length<=1||(this.session.activeWindowIndex=(this.session.activeWindowIndex+1)%this.session.windows.length,this._zoomedPaneId=null,this.onChange())}previousWindow(){this.session.windows.length<=1||(this.session.activeWindowIndex=(this.session.activeWindowIndex-1+this.session.windows.length)%this.session.windows.length,this._zoomedPaneId=null,this.onChange())}selectWindow(e){e<0||e>=this.session.windows.length||(this.session.activeWindowIndex=e,this._zoomedPaneId=null,this.onChange())}openWindowViewer(){this._overlay="window-viewer",this._windowViewerIndex=this.session.activeWindowIndex,this.onChange()}openKillPaneConfirm(){this._overlay="kill-pane-confirm",this.onChange()}closeOverlay(){this._overlay="none",this.onChange()}handleWindowViewerKey(e){if(this._overlay!=="window-viewer")return!1;switch(e){case"ArrowUp":case"k":return this._windowViewerIndex=Math.max(0,this._windowViewerIndex-1),this.onChange(),!0;case"ArrowDown":case"j":return this._windowViewerIndex=Math.min(this.session.windows.length-1,this._windowViewerIndex+1),this.onChange(),!0;case"Enter":return this.selectWindow(this._windowViewerIndex),this._overlay="none",this.onChange(),!0;case"q":case"Escape":return this._overlay="none",this.onChange(),!0;default:return!0}}handleKillPaneConfirmKey(e){return this._overlay!=="kill-pane-confirm"?!1:e==="y"||e==="Y"?(this._overlay="none",this.killPane(),!0):((e==="n"||e==="N"||e==="Escape"||e==="q")&&(this._overlay="none",this.onChange()),!0)}dispose(){this.prefixTimeout&&clearTimeout(this.prefixTimeout);for(const e of this.paneControllers.values())e.dispose();this.paneControllers.clear()}}function Ht(t,e){const s=/mac|iphone|ipad|ipod/i.test(navigator.userAgent);if(t.metaKey&&s)return"passthrough";if(s?t.metaKey:t.ctrlKey){const r=new Set(["l","t","w","n","q","Tab"]);if(t.shiftKey||r.has(t.key))return"passthrough"}const n=e.getOverlay();if(n==="window-viewer")return t.preventDefault(),e.handleWindowViewerKey(t.key),"handled";if(n==="kill-pane-confirm")return t.preventDefault(),e.handleKillPaneConfirmKey(t.key),e.isLastPane()&&(t.key==="y"||t.key==="Y")?"detach":"handled";if(e.isPrefixActive()){if(t.key==="Shift"||t.key==="Control"||t.key==="Alt"||t.key==="Meta")return"handled";switch(t.preventDefault(),e.cancelPrefix(),t.key){case"%":return e.splitPane("vertical"),"handled";case'"':return e.splitPane("horizontal"),"handled";case"ArrowUp":return e.navigatePane("up"),"handled";case"ArrowDown":return e.navigatePane("down"),"handled";case"ArrowLeft":return e.navigatePane("left"),"handled";case"ArrowRight":return e.navigatePane("right"),"handled";case"c":return e.createWindow(),"handled";case"n":return e.nextWindow(),"handled";case"p":return e.previousWindow(),"handled";case"w":return e.openWindowViewer(),"handled";case"d":return"detach";case"x":return e.isLastPane()?"detach":(e.openKillPaneConfirm(),"handled");case"z":return e.zoomPane(),"handled";default:return"handled"}}return t.ctrlKey&&t.key==="b"?(t.preventDefault(),e.activatePrefix(),"activate-prefix"):"passthrough"}const De="rgb(204,204,204)",Ne="rgb(0,0,0)";function Ft({controller:t,rect:e,isActive:s,focused:i}){const n=h.useRef(null),r=h.useRef(null),[,o]=h.useState(0);h.useEffect(()=>t.subscribe(()=>o(f=>f+1)),[t]),h.useEffect(()=>(t.setProcessContainer(n.current),()=>t.setProcessContainer(null)),[t]);const c=t.getHistory(),l=t.getInputLine(),u=t.getInputCursor(),a=t.getPromptText(),d=t.getMode();h.useEffect(()=>{r.current&&d==="shell"&&(r.current.scrollTop=r.current.scrollHeight)});const p=s&&i;return m.jsxs("div",{className:"absolute box-border",style:{left:`${e.x*100}%`,top:`${e.y*100}%`,width:`${e.width*100}%`,height:`${e.height*100}%`,borderColor:s?"#4ade80":"#333",borderWidth:"1px",borderStyle:"solid"},children:[d==="shell"&&m.jsxs("div",{ref:r,className:"h-full overflow-y-auto overflow-x-hidden px-2 py-1 text-sm font-mono leading-[1.2]",style:{color:De,backgroundColor:Ne},children:[c.map((f,y)=>m.jsx("div",{className:"whitespace-pre-wrap break-all min-h-[1.2em]",children:f.map((w,b)=>m.jsx("span",{className:[w.bold?"font-bold":"",w.italic?"italic":"",w.underline?"underline":""].filter(Boolean).join(" ")||void 0,style:{color:w.fg!==De?w.fg:void 0,backgroundColor:w.bg!==Ne?w.bg:void 0},children:w.char},b))},`h${y}`)),m.jsxs("div",{className:"whitespace-pre-wrap break-all min-h-[1.2em]",children:[m.jsx("span",{children:a}),m.jsx("span",{children:l.slice(0,u)}),m.jsx("span",{className:p?"animate-blink":void 0,style:{backgroundColor:p?"#d4d4d4":s?"#888":"#555"},children:l[u]??" "}),u<l.length&&m.jsx("span",{children:l.slice(u+1)})]})]}),m.jsx("div",{ref:n,className:d==="process"?"w-full h-full relative":"hidden"})]})}function zt(t){const e=le.c(23),{session:s,prefixActive:i,zoomed:n}=t,[r,o]=h.useState(Ut);let c,l;e[0]===Symbol.for("react.memo_cache_sentinel")?(c=()=>{const k=setInterval(()=>o(et()),1e3);return()=>clearInterval(k)},l=[],e[0]=c,e[1]=l):(c=e[0],l=e[1]),h.useEffect(c,l);let u;e[2]===Symbol.for("react.memo_cache_sentinel")?(u={height:"1.5em",lineHeight:"1.5em",backgroundColor:"#14532d",color:"#86efac"},e[2]=u):u=e[2];let a;e[3]===Symbol.for("react.memo_cache_sentinel")?(a=m.jsx("span",{children:"[0]"}),e[3]=a):a=e[3];let d;if(e[4]!==s.activeWindowIndex||e[5]!==s.windows||e[6]!==n){let k;e[8]!==s.activeWindowIndex||e[9]!==n?(k=(T,$)=>m.jsxs("span",{className:$===s.activeWindowIndex?"font-bold":"",children:[$,":",T.name,$===s.activeWindowIndex?"*":"",n&&$===s.activeWindowIndex?" (Z)":""]},T.id),e[8]=s.activeWindowIndex,e[9]=n,e[10]=k):k=e[10],d=s.windows.map(k),e[4]=s.activeWindowIndex,e[5]=s.windows,e[6]=n,e[7]=d}else d=e[7];let p;e[11]!==d?(p=m.jsxs("div",{className:"flex items-center gap-2",children:[a,d]}),e[11]=d,e[12]=p):p=e[12];let f;e[13]!==i?(f=i&&m.jsx("span",{style:{color:"#fbbf24"},children:"[PREFIX]"}),e[13]=i,e[14]=f):f=e[14];let y;e[15]!==r?(y=m.jsx("span",{children:r}),e[15]=r,e[16]=y):y=e[16];let w;e[17]!==f||e[18]!==y?(w=m.jsxs("div",{className:"flex items-center gap-2",children:[f,y]}),e[17]=f,e[18]=y,e[19]=w):w=e[19];let b;return e[20]!==p||e[21]!==w?(b=m.jsxs("div",{className:"flex items-center justify-between px-2 text-xs font-mono select-none shrink-0",style:u,children:[p,w]}),e[20]=p,e[21]=w,e[22]=b):b=e[22],b}function Ut(){return et()}function et(){const t=new Date;return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`}function Qt(t){const e=le.c(11),{session:s,selectedIndex:i}=t;let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n={backgroundColor:"rgba(0, 0, 0, 0.95)",borderColor:"#4ade80",color:"#d4d4d4"},e[0]=n):n=e[0];let r;e[1]===Symbol.for("react.memo_cache_sentinel")?(r=m.jsx("div",{className:"mb-2 text-xs",style:{color:"#86efac"},children:"Choose window (Enter=select, q=cancel)"}),e[1]=r):r=e[1];let o;if(e[2]!==i||e[3]!==s.activeWindowIndex||e[4]!==s.windows){let l;e[6]!==i||e[7]!==s.activeWindowIndex?(l=(u,a)=>{const d=L(u.layout).length,p=a===i,f=a===s.activeWindowIndex;return m.jsxs("div",{className:"py-0.5 px-1",style:{backgroundColor:p?"#14532d":"transparent",color:p?"#86efac":"#d4d4d4"},children:[p?">":" "," ",a,": ",u.name,f?" *":""," ","(",d," pane",d!==1?"s":"",")"]},u.id)},e[6]=i,e[7]=s.activeWindowIndex,e[8]=l):l=e[8],o=s.windows.map(l),e[2]=i,e[3]=s.activeWindowIndex,e[4]=s.windows,e[5]=o}else o=e[5];let c;return e[9]!==o?(c=m.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",children:m.jsxs("div",{className:"border rounded px-4 py-3 text-sm font-mono min-w-[300px] max-w-[80%]",style:n,children:[r,o]})}),e[9]=o,e[10]=c):c=e[10],c}function Gt(t){const e=le.c(36),{manager:s,focused:i}=t;let n;e[0]!==s?(n=s.getSnapshot(),e[0]=s,e[1]=n):n=e[1];const r=n;let o,c,l,u,a;if(e[2]!==i||e[3]!==s){const T=s.getActiveWindow(),$=s.computePaneRects();let A;e[9]!==s?(A=s.getOverlay(),e[9]=s,e[10]=A):A=e[10],o=A;const M=s.isZoomed()?[T.activePaneId]:L(T.layout);u="flex flex-col h-full w-full",e[11]===Symbol.for("react.memo_cache_sentinel")?(a={backgroundColor:"#000"},e[11]=a):a=e[11],c="relative flex-1 min-h-0",l=M.map(S=>{const Y=s.getPaneController(S),v=$.get(S);return!Y||!v?null:m.jsx(Ft,{controller:Y,rect:v,isActive:S===T.activePaneId,focused:i},S)}),e[2]=i,e[3]=s,e[4]=o,e[5]=c,e[6]=l,e[7]=u,e[8]=a}else o=e[4],c=e[5],l=e[6],u=e[7],a=e[8];let d;e[12]!==o?(d=o==="kill-pane-confirm"&&m.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-50",children:m.jsx("div",{className:"border rounded px-4 py-3 text-sm font-mono",style:{backgroundColor:"rgba(0, 0, 0, 0.95)",borderColor:"#ef4444",color:"#d4d4d4"},children:"kill-pane? (y/n)"})}),e[12]=o,e[13]=d):d=e[13];let p;e[14]!==s||e[15]!==o||e[16]!==r?(p=o==="window-viewer"&&m.jsx(Qt,{session:r,selectedIndex:s.getWindowViewerIndex()}),e[14]=s,e[15]=o,e[16]=r,e[17]=p):p=e[17];let f;e[18]!==c||e[19]!==l||e[20]!==d||e[21]!==p?(f=m.jsxs("div",{className:c,children:[l,d,p]}),e[18]=c,e[19]=l,e[20]=d,e[21]=p,e[22]=f):f=e[22];let y;e[23]!==s?(y=s.isPrefixActive(),e[23]=s,e[24]=y):y=e[24];let w;e[25]!==s?(w=s.isZoomed(),e[25]=s,e[26]=w):w=e[26];let b;e[27]!==r||e[28]!==w||e[29]!==y?(b=m.jsx(zt,{session:r,prefixActive:y,zoomed:w}),e[27]=r,e[28]=w,e[29]=y,e[30]=b):b=e[30];let k;return e[31]!==b||e[32]!==u||e[33]!==a||e[34]!==f?(k=m.jsxs("div",{className:u,style:a,children:[f,b]}),e[31]=b,e[32]=u,e[33]=a,e[34]=f,e[35]=k):k=e[35],k}const tt="rgb(204,204,204)",st="rgb(0,0,0)",We={char:" ",fg:tt,bg:st,bold:!1,italic:!1,underline:!1};Te("vim",t=>new qe(t));Te("vi",t=>new qe(t));Te("nvim",t=>new qe(t));function Yt(t){return`rgb(${t.fg_r},${t.fg_g},${t.fg_b})`}function Jt(t){return`rgb(${t.bg_r},${t.bg_g},${t.bg_b})`}function Ke(t,e,s){const i=t.getLine(e),n=[];if(i)for(let r=0;r<s;r++){const o=i[r];o?n.push({char:o.codepoint?String.fromCodePoint(o.codepoint):" ",fg:Yt(o),bg:Jt(o),bold:!!(o.flags&1),italic:!!(o.flags&4),underline:!!(o.flags&8)}):n.push(We)}else for(let r=0;r<s;r++)n.push(We);return n}function Xt(t){return t.some(e=>e.char!==" ")}function Le(t){const e=/mac|iphone|ipad|ipod/i.test(navigator.userAgent);if(e?t.metaKey:t.ctrlKey){const i=new Set(["l","t","w","n","q","Tab","shift"]);if(t.shiftKey||i.has(t.key))return null}return t.metaKey&&e?null:t.key==="Enter"?"\r":t.key==="Backspace"?"":t.key==="Tab"?"	":t.key==="ArrowUp"?"\x1B[A":t.key==="ArrowDown"?"\x1B[B":t.key==="ArrowRight"?"\x1B[C":t.key==="ArrowLeft"?"\x1B[D":t.key==="Home"?"\x1B[H":t.key==="End"?"\x1B[F":t.key==="Delete"?"\x1B[3~":t.ctrlKey&&t.key==="c"?"":t.ctrlKey&&t.key==="d"?"":t.ctrlKey&&t.key==="l"?"\f":t.ctrlKey&&t.key==="u"?"":t.ctrlKey&&t.key==="a"?"":t.ctrlKey&&t.key==="e"?"":t.ctrlKey&&t.key==="w"?"":t.ctrlKey&&t.key==="k"?"\v":t.ctrlKey&&t.key==="r"?"":t.ctrlKey&&t.key==="g"?"\x07":t.key==="Escape"?"\x1B":t.key.length===1&&!t.ctrlKey&&!t.metaKey?t.key:null}function Zt({cwd:t,setCwd:e}){const s=h.useRef(null),i=h.useRef(null),n=h.useRef(null),[r,o]=h.useState([]),[c,l]=h.useState(""),[u,a]=h.useState(0),[d,p]=h.useState(""),[f,y]=h.useState(!0),[w,b]=h.useState({kind:"shell"}),k=h.useRef(null),T=h.useRef(null),$=h.useRef(null),A=h.useRef(w),[M,S]=h.useState(!1),[,Y]=h.useState(0),v=h.useRef(null),C=h.useRef(null),P=h.useRef(t),O=h.useRef(e);h.useEffect(()=>{P.current=t},[t]),h.useEffect(()=>{O.current=e},[e]),h.useEffect(()=>{A.current=w},[w]),h.useEffect(()=>{(w.kind==="shell"||M)&&i.current?.focus()},[w,M]),h.useEffect(()=>{s.current&&w.kind==="shell"&&!M&&(s.current.scrollTop=s.current.scrollHeight)},[r,c,w,M]);const z=h.useCallback(()=>{const x=C.current;if(!x)return;const _=new Vt({ghosttyModule:x,initialCwd:P.current,onChange:()=>Y(g=>g+1)});v.current=_,S(!0)},[]),U=h.useCallback(()=>{const x=v.current;x&&(x.dispose(),v.current=null),S(!1),setTimeout(()=>{T.current?.printPrompt(),i.current?.focus()},0)},[]),K=h.useCallback((x,_)=>{const g=Ze(x);if(!g)return;const E=n.current;if(!E)return;const R={};if(_.length>0){const D=V(P.current,_[0]);R.__VFS_PATH__=D;const N=Be(D);N!==null&&(R.__FILE_CONTENT__=N)}const j=g({wasmUrl:"",args:_,env:R,cwd:P.current,cols:$.current?.cols||80,rows:$.current?.rows||24,container:E}),q=()=>{E.replaceChildren(),b({kind:"shell"}),setTimeout(()=>{T.current?.printPrompt(),i.current?.focus()},0)};j.onExit(()=>q()),b({kind:"process",process:j,cleanup:q}),j.start().catch(D=>{console.error("Failed to start process:",D),q()})},[]);h.useEffect(()=>{let x=!1,_;const g=document.createElement("div");g.style.position="absolute",g.style.left="-9999px",g.style.top="-9999px",g.style.width="1px",g.style.height="1px",g.style.overflow="hidden",document.body.appendChild(g);async function E(){const j=await He(()=>import("./ghostty-web-DzYsCKtA.js"),__vite__mapDeps([0,1,2])),{init:q,Terminal:D}=j;if(await q(),x)return;C.current={Terminal:D};const N=new D({fontSize:14});N.open(g),$.current=N,k.current=N.wasmTerm;const ue={write(W){N.write(W)}},Q=new Je(ue);T.current=Q;const Ee=()=>{const W=k.current;if(!W)return;const ie=N.cols||80,ae=N.rows||24,nt=W.getCursor()?.y??0;let he=-1;for(let X=ae-1;X>=0;X--){const re=Ke(W,X,ie);if(Xt(re)){he=X;break}}if(he>=0){const X=Math.max(he,nt-1),re=[];for(let se=0;se<=X;se++)re.push(Ke(W,se,ie));o(se=>[...se,...re])}N.write("\x1B[2J\x1B[H")};return Q.setBeforePromptCallback(Ee),Q.setInputChangeCallback((W,ie,ae)=>{l(W),a(ie),p(ae)}),Q.setContextProvider(()=>({cwd:P.current,setCwd:W=>{P.current=W,O.current(W)},clearHistory:()=>o([]),runProcess:K,getCommandHistory:()=>Q.getHistory(),startTmux:z})),_=$t(ue,Q),Mt(ue),Ee(),Q.printPrompt(),()=>{N.dispose()}}let R;return E().then(j=>{R=j}),()=>{x=!0,R?.(),_?.(),document.body.removeChild(g)}},[K,z]);function F(x){if(M){const E=v.current;if(!E)return;const R=Ht(x,E);if(R==="passthrough"){const j=E.getActivePane();if(!j||j.getMode()==="process")return;const q=Le(x);q!==null&&(x.preventDefault(),j.handleKeyData(q));return}if(R==="detach"){U();return}return}const _=T.current;if(!_||A.current.kind==="process")return;const g=Le(x);g!==null&&(x.preventDefault(),_.handleData(g))}function J(){(w.kind==="shell"||M)&&i.current?.focus()}return m.jsxs("div",{ref:s,onClick:J,className:`bg-black text-neutral-300 font-mono text-sm leading-[1.2] h-screen w-screen box-border cursor-text ${M?"overflow-hidden px-4 py-3 sm:px-[5vw] sm:py-[4vh] md:px-[8vw] md:py-[6vh] lg:px-[12vw] lg:py-[8vh]":w.kind==="shell"?"overflow-auto px-4 py-3 sm:px-[5vw] sm:py-[4vh] md:px-[8vw] md:py-[6vh] lg:px-[12vw] lg:py-[8vh]":"overflow-hidden px-4 py-3 sm:px-[5vw] sm:py-[4vh] md:px-[8vw] md:py-[6vh] lg:px-[12vw] lg:py-[8vh]"}`,children:[M&&v.current?m.jsx(Gt,{manager:v.current,focused:f}):m.jsxs(m.Fragment,{children:[w.kind==="shell"&&m.jsxs(m.Fragment,{children:[r.map((x,_)=>m.jsx("div",{className:"whitespace-pre min-h-[1.2em]",children:x.map((g,E)=>m.jsx("span",{className:[g.bold?"font-bold":"",g.italic?"italic":"",g.underline?"underline":""].filter(Boolean).join(" ")||void 0,style:{color:g.fg!==tt?g.fg:void 0,backgroundColor:g.bg!==st?g.bg:void 0},children:g.char},E))},`h${_}`)),m.jsxs("div",{className:"whitespace-pre min-h-[1.2em]",children:[m.jsx("span",{children:d}),m.jsx("span",{children:c.slice(0,u)}),m.jsx("span",{className:f?"animate-blink":void 0,style:{backgroundColor:f?"#d4d4d4":"#555"},children:c[u]??" "}),u<c.length&&m.jsx("span",{children:c.slice(u+1)})]})]}),m.jsx("div",{ref:n,className:w.kind==="process"?"w-full h-full relative":"hidden"})]}),m.jsx("textarea",{ref:i,onKeyDown:F,onFocus:()=>y(!0),onBlur:()=>y(!1),className:"absolute -left-[9999px] -top-[9999px] opacity-0 w-0 h-0 p-0 border-none",autoComplete:"off",spellCheck:!1,autoFocus:!0})]})}function ss(){const t=le.c(6);let e;t[0]===Symbol.for("react.memo_cache_sentinel")?(e=gt.withDefault("/"),t[0]=e):e=t[0];const[s,i]=xt("cwd",e);let n;t[1]!==s?(n=Ge(s)?s:"/",t[1]=s,t[2]=n):n=t[2];const r=n;let o;return t[3]!==i||t[4]!==r?(o=m.jsx(Zt,{cwd:r,setCwd:i}),t[3]=i,t[4]=r,t[5]=o):o=t[5],o}export{ss as component};
